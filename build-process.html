<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.2 Build process | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines</title>
  <meta name="description" content="4.2 Build process | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="4.2 Build process | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.2 Build process | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  
  
  

<meta name="author" content="Sarah Bonnin, Luca Cozzuto, Toni Hermoso, Julia Ponomarenko" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-singularity.html"/>
<link rel="next" href="run-and-execution-process.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Courses@CRG 2021</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome and about the course</a><ul>
<li class="chapter" data-level="1.1" data-path="meet-the-organizers-and-instructors.html"><a href="meet-the-organizers-and-instructors.html"><i class="fa fa-check"></i><b>1.1</b> Meet the organizers and instructors</a></li>
<li class="chapter" data-level="1.2" data-path="about-the-course.html"><a href="about-the-course.html"><i class="fa fa-check"></i><b>1.2</b> About the course</a><ul>
<li class="chapter" data-level="1.2.1" data-path="about-the-course.html"><a href="about-the-course.html#outline"><i class="fa fa-check"></i><b>1.2.1</b> Outline</a></li>
<li class="chapter" data-level="1.2.2" data-path="about-the-course.html"><a href="about-the-course.html#learning-objectives"><i class="fa fa-check"></i><b>1.2.2</b> Learning objectives</a></li>
<li class="chapter" data-level="1.2.3" data-path="about-the-course.html"><a href="about-the-course.html#prerequisite-technical-requirements"><i class="fa fa-check"></i><b>1.2.3</b> Prerequisite / technical requirements</a></li>
<li class="chapter" data-level="1.2.4" data-path="about-the-course.html"><a href="about-the-course.html#dates-time-location"><i class="fa fa-check"></i><b>1.2.4</b> Dates, time, location</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="program.html"><a href="program.html"><i class="fa fa-check"></i><b>1.3</b> Program</a><ul>
<li class="chapter" data-level="1.3.1" data-path="program.html"><a href="program.html#may-3-4-containers"><i class="fa fa-check"></i><b>1.3.1</b> May 3-4: Containers</a></li>
<li class="chapter" data-level="1.3.2" data-path="program.html"><a href="program.html#may-10-11-nextflow"><i class="fa fa-check"></i><b>1.3.2</b> May 10-11: Nextflow</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-containers.html"><a href="introduction-to-containers.html"><i class="fa fa-check"></i><b>2</b> Introduction to containers</a><ul>
<li class="chapter" data-level="2.1" data-path="what-are-containers.html"><a href="what-are-containers.html"><i class="fa fa-check"></i><b>2.1</b> What are containers ?</a></li>
<li class="chapter" data-level="2.2" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html"><i class="fa fa-check"></i><b>2.2</b> Virtual machines or containers ?</a><ul>
<li class="chapter" data-level="2.2.1" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html#virtualisation"><i class="fa fa-check"></i><b>2.2.1</b> Virtualisation</a></li>
<li class="chapter" data-level="2.2.2" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html#containerisation-aka-lightweight-virtualisation"><i class="fa fa-check"></i><b>2.2.2</b> Containerisation (aka lightweight virtualisation)</a></li>
<li class="chapter" data-level="2.2.3" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html#virtual-machines-vs-containers"><i class="fa fa-check"></i><b>2.2.3</b> Virtual machines vs containers</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="history-of-containers.html"><a href="history-of-containers.html"><i class="fa fa-check"></i><b>2.3</b> History of containers</a><ul>
<li class="chapter" data-level="2.3.1" data-path="history-of-containers.html"><a href="history-of-containers.html#chroot"><i class="fa fa-check"></i><b>2.3.1</b> chroot</a></li>
<li class="chapter" data-level="2.3.2" data-path="history-of-containers.html"><a href="history-of-containers.html#additions-in-linux-kernel"><i class="fa fa-check"></i><b>2.3.2</b> Additions in Linux kernel</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="docker.html"><a href="docker.html"><i class="fa fa-check"></i><b>3</b> Docker</a><ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html"><i class="fa fa-check"></i><b>3.1</b> Introduction to Docker</a><ul>
<li class="chapter" data-level="3.1.1" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#what-is-docker"><i class="fa fa-check"></i><b>3.1.1</b> What is Docker?</a></li>
<li class="chapter" data-level="3.1.2" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#docker-components"><i class="fa fa-check"></i><b>3.1.2</b> Docker components</a></li>
<li class="chapter" data-level="3.1.3" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#images-versus-containers"><i class="fa fa-check"></i><b>3.1.3</b> Images versus containers</a></li>
<li class="chapter" data-level="3.1.4" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#docker-vocabulary"><i class="fa fa-check"></i><b>3.1.4</b> Docker vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="using-existing-images.html"><a href="using-existing-images.html"><i class="fa fa-check"></i><b>3.2</b> Using existing images</a><ul>
<li class="chapter" data-level="3.2.1" data-path="using-existing-images.html"><a href="using-existing-images.html#getting-started"><i class="fa fa-check"></i><b>3.2.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2.2" data-path="using-existing-images.html"><a href="using-existing-images.html#explore-docker-hub"><i class="fa fa-check"></i><b>3.2.2</b> Explore Docker Hub</a></li>
<li class="chapter" data-level="3.2.3" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-pull-import-an-image"><i class="fa fa-check"></i><b>3.2.3</b> docker pull: import an image</a></li>
<li class="chapter" data-level="3.2.4" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-run-run-image-i.e.-start-a-container"><i class="fa fa-check"></i><b>3.2.4</b> docker run: run image, i.e. start a container</a></li>
<li class="chapter" data-level="3.2.5" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-ps-check-containers-status"><i class="fa fa-check"></i><b>3.2.5</b> docker ps: check containers status</a></li>
<li class="chapter" data-level="3.2.6" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-exec-execute-process-in-a-running-container"><i class="fa fa-check"></i><b>3.2.6</b> docker exec: execute process in a running container</a></li>
<li class="chapter" data-level="3.2.7" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-stop-start-restart-actions-on-container"><i class="fa fa-check"></i><b>3.2.7</b> docker stop, start, restart: actions on container</a></li>
<li class="chapter" data-level="3.2.8" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-rm-docker-rmi-clean-up"><i class="fa fa-check"></i><b>3.2.8</b> docker rm, docker rmi: clean up!</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="exercise-1-docker-as-a-user.html"><a href="exercise-1-docker-as-a-user.html"><i class="fa fa-check"></i><b>3.3</b> Exercise 1 - Docker as a user</a></li>
<li class="chapter" data-level="3.4" data-path="linux-packages.html"><a href="linux-packages.html"><i class="fa fa-check"></i><b>3.4</b> Linux packages</a><ul>
<li class="chapter" data-level="3.4.1" data-path="linux-packages.html"><a href="linux-packages.html#update-and-upgrade-packages"><i class="fa fa-check"></i><b>3.4.1</b> Update and upgrade packages</a></li>
<li class="chapter" data-level="3.4.2" data-path="linux-packages.html"><a href="linux-packages.html#search-and-install-packages"><i class="fa fa-check"></i><b>3.4.2</b> Search and install packages:</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="docker-recipes.html"><a href="docker-recipes.html"><i class="fa fa-check"></i><b>3.5</b> Docker recipes</a><ul>
<li class="chapter" data-level="3.5.1" data-path="docker-recipes.html"><a href="docker-recipes.html#writing-recipes-and-building-images"><i class="fa fa-check"></i><b>3.5.1</b> Writing recipes and building images</a></li>
<li class="chapter" data-level="3.5.2" data-path="docker-recipes.html"><a href="docker-recipes.html#docker-tag"><i class="fa fa-check"></i><b>3.5.2</b> docker tag</a></li>
<li class="chapter" data-level="3.5.3" data-path="docker-recipes.html"><a href="docker-recipes.html#build-cache"><i class="fa fa-check"></i><b>3.5.3</b> Build cache</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="exercise-2-docker-recipes-and-build-images.html"><a href="exercise-2-docker-recipes-and-build-images.html"><i class="fa fa-check"></i><b>3.6</b> Exercise 2 - Docker recipes and build images</a><ul>
<li class="chapter" data-level="3.6.1" data-path="exercise-2-docker-recipes-and-build-images.html"><a href="exercise-2-docker-recipes-and-build-images.html#additional-commands"><i class="fa fa-check"></i><b>3.6.1</b> Additional commands</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="volumes.html"><a href="volumes.html"><i class="fa fa-check"></i><b>3.7</b> Volumes</a></li>
<li class="chapter" data-level="3.8" data-path="ports.html"><a href="ports.html"><i class="fa fa-check"></i><b>3.8</b> Ports</a></li>
<li class="chapter" data-level="3.9" data-path="integrative-examples.html"><a href="integrative-examples.html"><i class="fa fa-check"></i><b>3.9</b> Integrative examples</a><ul>
<li class="chapter" data-level="3.9.1" data-path="integrative-examples.html"><a href="integrative-examples.html#fastqc-web-application"><i class="fa fa-check"></i><b>3.9.1</b> FASTQC Web Application</a></li>
<li class="chapter" data-level="3.9.2" data-path="integrative-examples.html"><a href="integrative-examples.html#shiny-application"><i class="fa fa-check"></i><b>3.9.2</b> Shiny Application</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="publish-images.html"><a href="publish-images.html"><i class="fa fa-check"></i><b>3.10</b> Publish images</a><ul>
<li class="chapter" data-level="3.10.1" data-path="publish-images.html"><a href="publish-images.html#push-an-image"><i class="fa fa-check"></i><b>3.10.1</b> Push an image</a></li>
<li class="chapter" data-level="3.10.2" data-path="publish-images.html"><a href="publish-images.html#automatic-builds"><i class="fa fa-check"></i><b>3.10.2</b> Automatic builds</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="exercise-3-docker-volumes-and-ports.html"><a href="exercise-3-docker-volumes-and-ports.html"><i class="fa fa-check"></i><b>3.11</b> Exercise 3 - Docker volumes and ports</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="singularity.html"><a href="singularity.html"><i class="fa fa-check"></i><b>4</b> Singularity</a><ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html"><i class="fa fa-check"></i><b>4.1</b> Introduction to Singularity</a><ul>
<li class="chapter" data-level="4.1.1" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html#singularity-architecture"><i class="fa fa-check"></i><b>4.1.1</b> Singularity architecture</a></li>
<li class="chapter" data-level="4.1.2" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html#strengths"><i class="fa fa-check"></i><b>4.1.2</b> Strengths</a></li>
<li class="chapter" data-level="4.1.3" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html#weaknesses"><i class="fa fa-check"></i><b>4.1.3</b> Weaknesses</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="build-process.html"><a href="build-process.html"><i class="fa fa-check"></i><b>4.2</b> Build process</a><ul>
<li class="chapter" data-level="4.2.1" data-path="build-process.html"><a href="build-process.html#examples"><i class="fa fa-check"></i><b>4.2.1</b> Examples</a></li>
<li class="chapter" data-level="4.2.2" data-path="build-process.html"><a href="build-process.html#sandboxing"><i class="fa fa-check"></i><b>4.2.2</b> Sandboxing</a></li>
<li class="chapter" data-level="4.2.3" data-path="build-process.html"><a href="build-process.html#singularity-recipes"><i class="fa fa-check"></i><b>4.2.3</b> Singularity recipes</a></li>
<li class="chapter" data-level="4.2.4" data-path="build-process.html"><a href="build-process.html#remote-building"><i class="fa fa-check"></i><b>4.2.4</b> Remote building</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html"><i class="fa fa-check"></i><b>4.3</b> Run and execution process</a><ul>
<li class="chapter" data-level="4.3.1" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#singularity-shell"><i class="fa fa-check"></i><b>4.3.1</b> Singularity shell</a></li>
<li class="chapter" data-level="4.3.2" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#singularity-exec"><i class="fa fa-check"></i><b>4.3.2</b> Singularity exec</a></li>
<li class="chapter" data-level="4.3.3" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#singularity-run"><i class="fa fa-check"></i><b>4.3.3</b> Singularity run</a></li>
<li class="chapter" data-level="4.3.4" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#environment-control"><i class="fa fa-check"></i><b>4.3.4</b> Environment control</a></li>
<li class="chapter" data-level="4.3.5" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#execute-from-sandboxed-images-directories"><i class="fa fa-check"></i><b>4.3.5</b> Execute from sandboxed images / directories</a></li>
<li class="chapter" data-level="4.3.6" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#execute-straight-from-a-registry"><i class="fa fa-check"></i><b>4.3.6</b> Execute straight from a registry</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="bind-paths-aka-volumes.html"><a href="bind-paths-aka-volumes.html"><i class="fa fa-check"></i><b>4.4</b> Bind paths (aka volumes)</a></li>
<li class="chapter" data-level="4.5" data-path="example-execution.html"><a href="example-execution.html"><i class="fa fa-check"></i><b>4.5</b> Example execution:</a></li>
<li class="chapter" data-level="4.6" data-path="instances.html"><a href="instances.html"><i class="fa fa-check"></i><b>4.6</b> Instances</a></li>
<li class="chapter" data-level="4.7" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>4.7</b> Troubleshooting</a><ul>
<li class="chapter" data-level="4.7.1" data-path="troubleshooting.html"><a href="troubleshooting.html#fakeroot"><i class="fa fa-check"></i><b>4.7.1</b> Fakeroot</a></li>
<li class="chapter" data-level="4.7.2" data-path="troubleshooting.html"><a href="troubleshooting.html#singularity-cache-directory"><i class="fa fa-check"></i><b>4.7.2</b> Singularity cache directory</a></li>
<li class="chapter" data-level="4.7.3" data-path="troubleshooting.html"><a href="troubleshooting.html#global-singularity-configuration"><i class="fa fa-check"></i><b>4.7.3</b> Global singularity configuration</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="exercise-4-singularity-running-and-building.html"><a href="exercise-4-singularity-running-and-building.html"><i class="fa fa-check"></i><b>4.8</b> Exercise 4 - Singularity running and building</a><ul>
<li class="chapter" data-level="4.8.1" data-path="exercise-4-singularity-running-and-building.html"><a href="exercise-4-singularity-running-and-building.html#blast-command-line-1"><i class="fa fa-check"></i><b>4.8.1</b> Blast command-line (1)</a></li>
<li class="chapter" data-level="4.8.2" data-path="exercise-4-singularity-running-and-building.html"><a href="exercise-4-singularity-running-and-building.html#blast-command-line-2"><i class="fa fa-check"></i><b>4.8.2</b> Blast command-line (2)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="nextflow-day-1.html"><a href="nextflow-day-1.html"><i class="fa fa-check"></i><b>5</b> Nextflow day 1</a><ul>
<li class="chapter" data-level="5.1" data-path="what-is-nextflow.html"><a href="what-is-nextflow.html"><i class="fa fa-check"></i><b>5.1</b> What is Nextflow?</a></li>
<li class="chapter" data-level="5.2" data-path="what-is-nextflow-for.html"><a href="what-is-nextflow-for.html"><i class="fa fa-check"></i><b>5.2</b> What is Nextflow for?</a></li>
<li class="chapter" data-level="5.3" data-path="main-advantages.html"><a href="main-advantages.html"><i class="fa fa-check"></i><b>5.3</b> Main advantages</a></li>
<li class="chapter" data-level="5.4" data-path="workflow-structure.html"><a href="workflow-structure.html"><i class="fa fa-check"></i><b>5.4</b> Workflow structure</a></li>
<li class="chapter" data-level="5.5" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>5.5</b> Installation</a></li>
<li class="chapter" data-level="5.6" data-path="channels-and-operators.html"><a href="channels-and-operators.html"><i class="fa fa-check"></i><b>5.6</b> Channels and Operators</a></li>
<li class="chapter" data-level="5.7" data-path="exercise-1.html"><a href="exercise-1.html"><i class="fa fa-check"></i><b>5.7</b> EXERCISE 1</a></li>
<li class="chapter" data-level="5.8" data-path="processes.html"><a href="processes.html"><i class="fa fa-check"></i><b>5.8</b> Processes</a></li>
<li class="chapter" data-level="5.9" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>5.9</b> Workflow</a></li>
<li class="chapter" data-level="5.10" data-path="nextflow-log.html"><a href="nextflow-log.html"><i class="fa fa-check"></i><b>5.10</b> Nextflow log</a></li>
<li class="chapter" data-level="5.11" data-path="exercise-2.html"><a href="exercise-2.html"><i class="fa fa-check"></i><b>5.11</b> EXERCISE 2</a></li>
<li class="chapter" data-level="5.12" data-path="more-complex-scripts.html"><a href="more-complex-scripts.html"><i class="fa fa-check"></i><b>5.12</b> More complex scripts</a></li>
<li class="chapter" data-level="5.13" data-path="directives.html"><a href="directives.html"><i class="fa fa-check"></i><b>5.13</b> Directives</a></li>
<li class="chapter" data-level="5.14" data-path="resuming-your-pipeline.html"><a href="resuming-your-pipeline.html"><i class="fa fa-check"></i><b>5.14</b> Resuming your pipeline</a></li>
<li class="chapter" data-level="5.15" data-path="exercise-3.html"><a href="exercise-3.html"><i class="fa fa-check"></i><b>5.15</b> EXERCISE 3</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nextflow-day-2.html"><a href="nextflow-day-2.html"><i class="fa fa-check"></i><b>6</b> Nextflow day 2</a><ul>
<li class="chapter" data-level="6.1" data-path="decoupling-resources-parameters-and-nextflow-script.html"><a href="decoupling-resources-parameters-and-nextflow-script.html"><i class="fa fa-check"></i><b>6.1</b> Decoupling resources, parameters and nextflow script</a><ul>
<li class="chapter" data-level="6.1.1" data-path="decoupling-resources-parameters-and-nextflow-script.html"><a href="decoupling-resources-parameters-and-nextflow-script.html#publishing-final-results"><i class="fa fa-check"></i><b>6.1.1</b> Publishing final results</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="adding-a-help-section-for-the-whole-pipeline.html"><a href="adding-a-help-section-for-the-whole-pipeline.html"><i class="fa fa-check"></i><b>6.2</b> Adding a help section for the whole pipeline</a></li>
<li class="chapter" data-level="6.3" data-path="exercise-4.html"><a href="exercise-4.html"><i class="fa fa-check"></i><b>6.3</b> EXERCISE 4</a></li>
<li class="chapter" data-level="6.4" data-path="using-singularity.html"><a href="using-singularity.html"><i class="fa fa-check"></i><b>6.4</b> Using Singularity</a></li>
<li class="chapter" data-level="6.5" data-path="adding-more-steps.html"><a href="adding-more-steps.html"><i class="fa fa-check"></i><b>6.5</b> Adding more steps</a></li>
<li class="chapter" data-level="6.6" data-path="profiles.html"><a href="profiles.html"><i class="fa fa-check"></i><b>6.6</b> Profiles</a></li>
<li class="chapter" data-level="6.7" data-path="deployment-in-the-aws-cloud.html"><a href="deployment-in-the-aws-cloud.html"><i class="fa fa-check"></i><b>6.7</b> Deployment in the AWS cloud</a></li>
<li class="chapter" data-level="6.8" data-path="exercise-5.html"><a href="exercise-5.html"><i class="fa fa-check"></i><b>6.8</b> EXERCISE 5</a></li>
<li class="chapter" data-level="6.9" data-path="modules-and-re-usage-of-the-code.html"><a href="modules-and-re-usage-of-the-code.html"><i class="fa fa-check"></i><b>6.9</b> Modules and re-usage of the code</a></li>
<li class="chapter" data-level="6.10" data-path="exercise-6.html"><a href="exercise-6.html"><i class="fa fa-check"></i><b>6.10</b> EXERCISE 6</a></li>
<li class="chapter" data-level="6.11" data-path="reporting-and-graphical-interface.html"><a href="reporting-and-graphical-interface.html"><i class="fa fa-check"></i><b>6.11</b> Reporting and graphical interface</a></li>
<li class="chapter" data-level="6.12" data-path="share-nextflow-pipelines-and-good-practices.html"><a href="share-nextflow-pipelines-and-good-practices.html"><i class="fa fa-check"></i><b>6.12</b> Share Nextflow pipelines and good practices</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://biocore.crg.eu/wiki/Main_Page" target="blank">BIOINFORMATICS CORE @ CRG</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="build-process" class="section level2">
<h2><span class="header-section-number">4.2</span> Build process</h2>
<!-- New image needs to be created based on this -->
<p><img src="docs/images/singularity_build_input_output.svg" width="600"></p>
<div id="examples" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Examples</h3>
<p>There are different ways to generate Singularity image files. The most common way is so far thanks to existing Docker images already present in public registries.</p>
<div id="through-registries" class="section level4">
<h4><span class="header-section-number">4.2.1.1</span> Through registries</h4>
<div id="docker-hub" class="section level5">
<h5><span class="header-section-number">4.2.1.1.1</span> Docker Hub</h5>
<p><a href="https://hub.docker.com/r/biocontainers/fastqc">https://hub.docker.com/r/biocontainers/fastqc</a></p>
<pre><code>singularity build fastqc-0.11.9_cv7.sif docker://biocontainers/fastqc:v0.11.9_cv7</code></pre>
</div>
<div id="biocontainers" class="section level5">
<h5><span class="header-section-number">4.2.1.1.2</span> Biocontainers</h5>
<div id="via-quay.io" class="section level6">
<h6><span class="header-section-number">4.2.1.1.2.1</span> Via quay.io</h6>
<p><a href="https://quay.io/repository/biocontainers/fastqc">https://quay.io/repository/biocontainers/fastqc</a></p>
<pre><code>singularity build fastqc-0.11.9.sif docker://quay.io/biocontainers/fastqc:0.11.9--0</code></pre>
</div>
<div id="via-galaxy-project-prebuilt-images" class="section level6">
<h6><span class="header-section-number">4.2.1.1.2.2</span> Via Galaxy project prebuilt images</h6>
<pre><code>singularity pull --name fastqc-0.11.9.sif https://depot.galaxyproject.org/singularity/fastqc:0.11.9--0</code></pre>

<div class="rmdnote">
Galaxy project provides all Bioinformatics software from Biocontainers initiative as Singularity prebuilt images. If download and conversion time of images is an issue for you, this is likely the best option if working in the biomedical field.
</div>

</div>
</div>
<div id="sylabs-registry" class="section level5">
<h5><span class="header-section-number">4.2.1.1.3</span> Sylabs registry</h5>
<p>Not as popular so far, but it provides fast download of images.</p>
<ul>
<li><a href="https://cloud.sylabs.io/library">https://cloud.sylabs.io/library</a></li>
</ul>
</div>
</div>
<div id="docker-daemon" class="section level4">
<h4><span class="header-section-number">4.2.1.2</span> Docker Daemon</h4>
<p>If you create your own images (as we did during the course) and you don’t want to share them publicly (and you have not access to any private image registry, either), you can convert your locally built Docker images into Singularity image files.</p>
<pre><code>    singularity build fastqc-web-0.11.9.sif docker-daemon://fastqcwww</code></pre>
</div>
</div>
<div id="sandboxing" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Sandboxing</h3>
<p>Instead of generating an image file, it is actually possible to use a whole directory with its contents. This is handy when specific changes may be needed.</p>
<pre><code>     singularity build --sandbox ./sandbox docker://ubuntu:18.04
     touch sandbox/etc/myetc.conf
     singularity build sandbox.sif ./sandbox</code></pre>

<div class="rmdnote">
Apart from testing or debugging, as we commented with Docker, we don’t recommend this approach because it makes reproducibility more difficult.
</div>

</div>
<div id="singularity-recipes" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Singularity recipes</h3>
<p>Singularity provides its own build system and recipe syntax. Despite it is actually possible to generate images from scratch (known as <strong><em>bootstraping</em></strong>) thanks to these recipes, this is at time of writing far slower than converting from Docker ones. Docker has the advantage of saving every action line as a cached image. That is not happening with Singularity.</p>
<p>When using recipes, it’s mandatory to have administrator permissions (e.g., as beeing root or via <strong>sudo</strong>).</p>
<p>In any case, it can still be useful to boostrap an image derived from a previously existing one. Below we provide two common approaches:</p>
<div id="docker-bootstrap" class="section level4">
<h4><span class="header-section-number">4.2.3.1</span> Docker bootstrap</h4>
<p>Instead of converting a Docker image into a Singularity one, it’s possible to use one as a base one and modify it by using Singularity recipe syntax.</p>
<pre><code>BootStrap: docker
From: biocontainers/fastqc:v0.11.9_cv7

%runscript
    echo &quot;Welcome to FastQC Image&quot;
    fastqc --version

%post
    echo &quot;Image built&quot;</code></pre>
<pre><code>sudo singularity build fastqc.sif docker.singularity</code></pre>

<div class="rmdtip">
The command %runscript would be equivalent to ENTRYPOINT/CMD in Docker. It is only triggered when using <code>singularity run</code>. This is useful if you want to hide from the user the complexity of a command-line path or an included custom script.
</div>

</div>
<div id="debian-bootstrap" class="section level4">
<h4><span class="header-section-number">4.2.3.2</span> Debian bootstrap</h4>
<p>Alternatively, we can build the whole image from Debian/Ubuntu distribution. This will normally take a while.</p>
<pre><code>BootStrap: debootstrap
OSVersion: bionic
MirrorURL:  http://fr.archive.ubuntu.com/ubuntu/
Include: build-essential curl python python-dev openjdk-11-jdk bzip2 zip unzip

%runscript
    echo &quot;Welcome to my Singularity Image&quot;
    fastqc --version
    multiqc --version
    bowtie --version

%post

    FASTQC_VERSION=0.11.9
    MULTIQC_VERSION=1.9
    BOWTIE_VERSION=1.3.0

    cd /usr/local; curl -k -L https://www.bioinformatics.babraham.ac.uk/projects/fastqc/fastqc_v${FASTQC_VERSION}.zip &gt; fastqc.zip
    cd /usr/local; unzip fastqc.zip; rm fastqc.zip; chmod 775 FastQC/fastqc; ln -s /usr/local/FastQC/fastqc /usr/local/bin/fastqc

    cd /usr/local; curl --fail --silent --show-error --location --remote-name https://github.com/BenLangmead/bowtie/releases/download/v$BOWTIE_VERSION/bowtie-${BOWTIE_VERSION}-linux-x86_64.zip
    cd /usr/local; unzip -d /usr/local bowtie-${BOWTIE_VERSION}-linux-x86_64.zip
    cd /usr/local; rm bowtie-${BOWTIE_VERSION}-linux-x86_64.zip
    cd /usr/local/bin; ln -s ../bowtie-${BOWTIE_VERSION}-linux-x86_64/bowtie* .

    curl --fail --silent --show-error --location --remote-name  https://bootstrap.pypa.io/pip/2.7/get-pip.py
    python get-pip.py

    pip install numpy matplotlib
    pip install -I multiqc==${MULTIQC_VERSION}

    echo &quot;Biocore image built&quot;

%labels
    Maintainer Biocorecrg
Version 0.1.0</code></pre>
<pre><code>sudo singularity build fastqc-multi-bowtie.sif debootstrap.singularity</code></pre>

<div class="rmdtip">
The available deboostrap recipes depend on the version you have installed in the system. Check at: <code>/usr/share/debootstrap/scripts/</code> for more details. For Debian, instead of Ubuntu, you can replace mirrorURL with <a href="https://ftp.debian.org/debian/" class="uri">https://ftp.debian.org/debian/</a> More details at: <a href="https://sylabs.io/guides/3.7/user-guide/appendix.html#build-debootstrap" class="uri">https://sylabs.io/guides/3.7/user-guide/appendix.html#build-debootstrap</a>
</div>


<div class="rmdnote">
It’s possible to sign cryptographically your images, so third parties can verify they are coming from their actual authors. This implies some matters beyond the scope of this course, but you have some details if interested at: <a href="https://sylabs.io/guides/3.7/user-guide/signNverify.html" class="uri">https://sylabs.io/guides/3.7/user-guide/signNverify.html</a>
</div>

</div>
</div>
<div id="remote-building" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Remote building</h3>
<p>This allows us to build a Singularity image without using our own computer. This is convenient if your machine has not many resources or if you don’t have administrator privileges.</p>
<ul>
<li>We need to create a <a href="Sylabs%20Cloud">https://cloud.sylabs.io/</a> account first.</li>
</ul>
<div class="sourceCode" id="cb103"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb103-1"><a href="build-process.html#cb103-1"></a>    <span class="ex">singularity</span> remote login</span></code></pre></div>
<ul>
<li>In order to use it our username and passwords we generate a token at <a href="https://cloud.sylabs.io/auth/tokens" class="uri">https://cloud.sylabs.io/auth/tokens</a> and copy its contents to a file (e.g., <code>singularity.token</code>). Then we use in the command-line below:</li>
</ul>
<div class="sourceCode" id="cb104"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb104-1"><a href="build-process.html#cb104-1"></a>    <span class="ex">singularity</span> remote login --tokenfile singularity.token</span></code></pre></div>
<details>
<summary>
<h5>
<em>Output</em>
</h5>
</summary>
(base) [<a href="mailto:ec2-user@ip-172-31-47-200" class="email">ec2-user@ip-172-31-47-200</a> ~]$ singularity remote login –tokenfile singularity.token
INFO: Access Token Verified!
INFO: Token stored in /home/ec2-user/.singularity/remote.yaml
</details>

<div class="rmdtip">
For safety reasons, remove the token from Cloud Sylabs interface after the course. Follow the same philosophy for similar circumstances. Keep an only token for a specific environment or action.
</div>

<ul>
<li>Once we are authenticated with our access token, we can <strong>build an image</strong>:</li>
</ul>
<div class="sourceCode" id="cb105"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb105-1"><a href="build-process.html#cb105-1"></a>    <span class="ex">singularity</span> build --remote focal.sif docker://ubuntu:focal</span></code></pre></div>
<ul>
<li>Since we are already authenticated, we can take advantage to push a Singularity image in our account, similarly to what we did with Docker. We use <code>-U</code> so we do not sign the image.</li>
</ul>
<div class="sourceCode" id="cb106"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb106-1"><a href="build-process.html#cb106-1"></a>    <span class="ex">singularity</span> push -U focal.sif library://toniher/test/focal.sif:latest</span></code></pre></div>

<div class="rmdtip">
IMPORTANT: Unless it is not defined in advance as private from Cloud Sylabs interface, pushed image will be public and there does not seem an easy way to turn it private.
As an interesting feature, you can actually sign your images after you pushed them from Cloud Sylabs web interface by using a key associated to your account (which can also be created there).
</div>


<div class="rmdnote">
More details at <a href="https://sylabs.io/guides/3.7/user-guide/cloud_library.html">https://sylabs.io/guides/3.7/user-guide/cloud_library.html</a>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-singularity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="run-and-execution-process.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["courses_at_crg_2021.pdf", "courses_at_crg_2021.epub"],
"toc": {
"collapse": "section"
},
"search": true
});
});
</script>

</body>

</html>
